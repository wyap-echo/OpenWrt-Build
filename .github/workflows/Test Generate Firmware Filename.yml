name: Test Generate Firmware Filename

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code ğŸ› ï¸
      uses: actions/checkout@main
      # æ£€å‡ºä»£ç 

    - name: Generate firmware filename ğŸ“
      id: generate_filename
      run: |
        # ä½¿ç”¨å›ºå®šçš„ç‰ˆæœ¬å·
        VERSION="immortalwrt-21.02"
        # æ‰“å°æ—¶é—´æˆ³è°ƒè¯•è¾“å‡º
        echo "Timestamp: ${{ github.event.head_commit.timestamp }}"
        # æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºå¤‡ç”¨
        if [ -z "${{ github.event.head_commit.timestamp }}" ]; then
          echo "Timestamp is empty, using current date."
          TIMESTAMP=$(date '+%Y%m%d')  # ä½¿ç”¨å½“å‰æ—¥æœŸä½œä¸ºå¤‡ç”¨
        else
          TIMESTAMP=$(date -d @${{ github.event.head_commit.timestamp }} '+%Y%m%d')
        fi
        # ç”Ÿæˆå®Œæ•´çš„æ–‡ä»¶å
        FILENAME="RAX3000M_mediatek_mt7981_${VERSION}-${{ github.run_id }}-${TIMESTAMP}"
        echo "Generated firmware filename: $FILENAME"
        echo "FILENAME=$FILENAME" >> $GITHUB_ENV
      # ä»…éªŒè¯æ–‡ä»¶åç”Ÿæˆ

    - name: Output the generated firmware filename
      run: |
        echo "The generated firmware filename is: ${{ env.FILENAME }}"
      # è¾“å‡ºæ–‡ä»¶åï¼Œæ£€æŸ¥æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
