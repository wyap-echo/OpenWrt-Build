name: Test Generate Firmware Filename

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code 🛠️
      uses: actions/checkout@main
      # 检出代码

    - name: Generate firmware filename 📝
      id: generate_filename
      run: |
        # 使用固定的版本号
        VERSION="immortalwrt-21.02"
        # 打印时间戳调试输出
        echo "Timestamp: ${{ github.event.head_commit.timestamp }}"
        # 检查时间戳是否为空，如果为空，则使用当前时间戳作为备用
        if [ -z "${{ github.event.head_commit.timestamp }}" ]; then
          echo "Timestamp is empty, using current date."
          TIMESTAMP=$(date '+%Y%m%d')  # 使用当前日期作为备用
        else
          TIMESTAMP=$(date -d @${{ github.event.head_commit.timestamp }} '+%Y%m%d')
        fi
        # 生成完整的文件名
        FILENAME="RAX3000M_mediatek_mt7981_${VERSION}-${{ github.run_id }}-${TIMESTAMP}"
        echo "Generated firmware filename: $FILENAME"
        echo "FILENAME=$FILENAME" >> $GITHUB_ENV
      # 仅验证文件名生成

    - name: Output the generated firmware filename
      run: |
        echo "The generated firmware filename is: ${{ env.FILENAME }}"
      # 输出文件名，检查是否正确生成
